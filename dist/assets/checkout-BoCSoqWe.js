import"./modulepreload-polyfill-B5Qt9EMX.js";const p="https://agbmljovmexflolbgljn.supabase.co",g="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFnYm1sam92bWV4ZmxvbGJnbGpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3OTg3ODAsImV4cCI6MjA4MzM3NDc4MH0.dBQxzYtka4nD0eJQFH0Izj-jbQBX4kEoMS0vZrSOtRA";let h=null,y=null,f=null,m=[];function r(e){const t=document.getElementById("error-message"),a=document.getElementById("error-text");a.textContent=e,t.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{t.classList.add("hidden")},5e3)}function v(){document.getElementById("error-message").classList.add("hidden")}function E(e){for(let t=1;t<=3;t++){const a=document.getElementById(`step${t}-indicator`);t<e?(a.classList.add("completed"),a.classList.remove("active")):t===e?(a.classList.add("active"),a.classList.remove("completed")):a.classList.remove("active","completed")}}function I(e){for(let t=1;t<=3;t++){const a=document.getElementById(`step${t}`);t===e?a.classList.remove("hidden"):a.classList.add("hidden")}E(e),window.scrollTo({top:0,behavior:"smooth"})}async function b(){v();const e=document.getElementById("firstName").value.trim(),t=document.getElementById("lastName").value.trim(),a=document.getElementById("email").value.trim(),n=document.getElementById("phone").value.trim();if(!e||!t||!a||!n){r("Please fill in all required fields");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){r("Please enter a valid email address");return}I(2),m.length===0&&await x()}function B(){v(),I(1)}async function w(){if(v(),!h){r("Please select a package");return}const e=m.find(n=>n.clubready_package_id===h);e&&(document.getElementById("summary-package").textContent=e.name,document.getElementById("summary-duration").textContent=e.duration_months===1?"1 Month":`${e.duration_months} Months`,document.getElementById("summary-total").textContent=`$${parseFloat(e.price).toFixed(2)}`);const t=document.getElementById("firstName").value.trim(),a=document.getElementById("lastName").value.trim();document.getElementById("cardholderName").value=`${t} ${a}`,I(3)}async function x(){try{const e=await fetch(`${p}/functions/v1/clubready-get-packages`,{method:"GET",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"}}),t=await e.json();if(!e.ok)throw new Error(t.error||"Failed to load packages");m=t.packages||[],k()}catch(e){console.error("Error loading packages:",e),r("Failed to load packages. Please refresh the page.")}}function k(){const e=document.getElementById("packages-container");if(m.length===0){e.innerHTML=`
      <div class="text-center py-8 text-gray-400">
        <p>No packages available at this time. Please contact us for more information.</p>
      </div>
    `;return}e.innerHTML=m.map(t=>`
    <div class="package-card cursor-pointer p-6 bg-black border-2 border-white/10 rounded-sm transition-all hover:border-white/30"
         data-package-id="${t.clubready_package_id}"
         onclick="selectPackage('${t.clubready_package_id}')">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <h3 class="text-xl font-heading font-bold uppercase mb-2">${t.name}</h3>
          ${t.description?`<p class="text-gray-400 text-sm mb-4">${t.description}</p>`:""}
          <div class="flex items-baseline gap-2">
            <span class="text-3xl font-bold text-accent">$${parseFloat(t.price).toFixed(2)}</span>
            <span class="text-gray-400 text-sm">/ ${t.duration_months===1?"month":t.duration_months+" months"}</span>
          </div>
        </div>
        <div class="w-6 h-6 rounded-full border-2 border-white/20 flex items-center justify-center package-radio">
          <div class="w-3 h-3 rounded-full bg-accent hidden"></div>
        </div>
      </div>
    </div>
  `).join("")}window.selectPackage=function(e){h=e,document.querySelectorAll(".package-card").forEach(a=>{a.classList.remove("selected"),a.querySelector(".package-radio div").classList.add("hidden")});const t=document.querySelector(`[data-package-id="${e}"]`);t&&(t.classList.add("selected"),t.querySelector(".package-radio div").classList.remove("hidden")),document.getElementById("continueToPayment").disabled=!1};function N(e){const a=e.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),n=a&&a[0]||"",s=[];for(let o=0,c=n.length;o<c;o+=4)s.push(n.substring(o,o+4));return s.length?s.join(" "):e}document.getElementById("cardNumber").addEventListener("input",function(e){e.target.value=N(e.target.value)});document.getElementById("cardExpMonth").addEventListener("input",function(e){e.target.value=e.target.value.replace(/[^0-9]/g,"")});document.getElementById("cardExpYear").addEventListener("input",function(e){e.target.value=e.target.value.replace(/[^0-9]/g,"")});document.getElementById("cardCvv").addEventListener("input",function(e){e.target.value=e.target.value.replace(/[^0-9]/g,"")});async function P(){const e=document.getElementById("firstName").value.trim(),t=document.getElementById("lastName").value.trim(),a=document.getElementById("email").value.trim(),n=document.getElementById("phone").value.trim(),s=document.getElementById("dateOfBirth").value||null;try{const o=await fetch(`${p}/functions/v1/clubready-search-prospect`,{method:"POST",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"},body:JSON.stringify({email:a,phone:n})}),c=await o.json();if(o.ok&&c.found&&c.prospect)return y=c.prospect.userId,f=c.prospect.userId.toString(),!0;const d=await fetch(`${p}/functions/v1/clubready-create-prospect`,{method:"POST",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"},body:JSON.stringify({firstName:e,lastName:t,email:a,phone:n,dateOfBirth:s})}),i=await d.json();if(!d.ok)throw new Error(i.error||"Failed to create prospect");return y=i.prospect.id,f=i.prospect.clubreadyUserId.toString(),!0}catch(o){throw console.error("Error with prospect:",o),o}}async function S(){v();const e=document.getElementById("cardNumber").value.replace(/\s/g,""),t=document.getElementById("cardExpMonth").value,a=document.getElementById("cardExpYear").value,n=document.getElementById("cardCvv").value,s=document.getElementById("cardholderName").value.trim(),o=document.getElementById("billingZip").value.trim();if(!e||!t||!a||!n||!s||!o){r("Please fill in all payment fields");return}if(e.length<13||e.length>19){r("Please enter a valid card number");return}if(t.length!==2||parseInt(t)<1||parseInt(t)>12){r("Please enter a valid expiration month (01-12)");return}if(a.length!==4||parseInt(a)<new Date().getFullYear()){r("Please enter a valid expiration year");return}if(n.length<3||n.length>4){r("Please enter a valid CVV");return}const c=document.getElementById("submitPayment"),d=document.getElementById("submit-text"),i=document.getElementById("submit-spinner");c.disabled=!0,d.classList.add("hidden"),i.classList.remove("hidden");try{(!y||!f)&&await P();const l=await fetch(`${p}/functions/v1/clubready-process-payment`,{method:"POST",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"},body:JSON.stringify({prospectId:y,clubreadyUserId:f,packageId:h,cardNumber:e,cardExpMonth:t,cardExpYear:a,cardCvv:n,cardholderName:s,billingZip:o})}),u=await l.json();if(!l.ok)throw new Error(u.error||"Payment processing failed");window.location.href=`thank-you-page.html?transactionId=${u.transactionId}&packageName=${encodeURIComponent(u.packageName)}&amount=${u.amount}`}catch(l){console.error("Payment error:",l),r(l.message||"Payment processing failed. Please try again."),c.disabled=!1,d.classList.remove("hidden"),i.classList.add("hidden")}}window.goToStep1=B;window.goToStep2=b;window.goToStep3=w;window.processPayment=S;
