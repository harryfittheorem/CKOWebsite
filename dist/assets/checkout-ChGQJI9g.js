import"./modulepreload-polyfill-B5Qt9EMX.js";const g="https://agbmljovmexflolbgljn.supabase.co",h="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFnYm1sam92bWV4ZmxvbGJnbGpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3OTg3ODAsImV4cCI6MjA4MzM3NDc4MH0.dBQxzYtka4nD0eJQFH0Izj-jbQBX4kEoMS0vZrSOtRA",b=new URLSearchParams(window.location.search).has("test")||window.location.hostname==="localhost"||!1;let u=null,y=null,f=null,d=[];function r(e){const t=document.getElementById("error-message"),a=document.getElementById("error-text");a.textContent=e,t.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{t.classList.add("hidden")},5e3)}function v(){document.getElementById("error-message").classList.add("hidden")}function B(e){for(let t=1;t<=3;t++){const a=document.getElementById(`step${t}-indicator`);t<e?(a.classList.add("completed"),a.classList.remove("active")):t===e?(a.classList.add("active"),a.classList.remove("completed")):a.classList.remove("active","completed")}}function I(e){for(let t=1;t<=3;t++){const a=document.getElementById(`step${t}`);t===e?a.classList.remove("hidden"):a.classList.add("hidden")}B(e),window.scrollTo({top:0,behavior:"smooth"})}if(b){const e=document.createElement("div");e.className="fixed top-0 left-0 right-0 bg-yellow-500 text-black text-center py-2 px-4 font-semibold text-sm z-[100] flex items-center justify-center gap-2",e.innerHTML=`
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg>
    TEST MODE - No real charges will be made
  `,document.body.prepend(e),document.querySelector("nav").style.marginTop="40px"}async function x(){v();const e=document.getElementById("firstName").value.trim(),t=document.getElementById("lastName").value.trim(),a=document.getElementById("email").value.trim(),n=document.getElementById("phone").value.trim();if(!e||!t||!a||!n){r("Please fill in all required fields");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){r("Please enter a valid email address");return}I(2),d.length===0&&await T()}function k(){v(),I(1)}async function S(){if(v(),!u){r("Please select a package");return}const e=d.find(n=>n.clubready_package_id===u);e&&(document.getElementById("summary-package").textContent=e.name,document.getElementById("summary-duration").textContent=e.duration_months===1?"1 Month":`${e.duration_months} Months`,document.getElementById("summary-total").textContent=`$${parseFloat(e.price).toFixed(2)}`);const t=document.getElementById("firstName").value.trim(),a=document.getElementById("lastName").value.trim();document.getElementById("cardholderName").value=`${t} ${a}`,I(3)}async function T(){try{const e=await fetch(`${g}/functions/v1/clubready-get-packages`,{method:"GET",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}}),t=await e.json();if(!e.ok)throw new Error(t.error||"Failed to load packages");d=t.packages||[],N()}catch(e){console.error("Error loading packages:",e),r("Failed to load packages. Please refresh the page.")}}function N(){const e=document.getElementById("packages-container");if(d.length===0){e.innerHTML=`
      <div class="text-center py-8 text-gray-400">
        <p>No packages available at this time. Please contact us for more information.</p>
      </div>
    `;return}e.innerHTML=d.map(t=>`
    <div class="package-card cursor-pointer p-6 bg-black border-2 border-white/10 rounded-sm transition-all hover:border-white/30"
         data-package-id="${t.clubready_package_id}"
         onclick="selectPackage('${t.clubready_package_id}')">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <h3 class="text-xl font-heading font-bold uppercase mb-2">${t.name}</h3>
          ${t.description?`<p class="text-gray-400 text-sm mb-4">${t.description}</p>`:""}
          <div class="flex items-baseline gap-2">
            <span class="text-3xl font-bold text-accent">$${parseFloat(t.price).toFixed(2)}</span>
            <span class="text-gray-400 text-sm">/ ${t.duration_months===1?"month":t.duration_months+" months"}</span>
          </div>
        </div>
        <div class="w-6 h-6 rounded-full border-2 border-white/20 flex items-center justify-center package-radio">
          <div class="w-3 h-3 rounded-full bg-accent hidden"></div>
        </div>
      </div>
    </div>
  `).join("")}window.selectPackage=function(e){u=e,document.querySelectorAll(".package-card").forEach(a=>{a.classList.remove("selected"),a.querySelector(".package-radio div").classList.add("hidden")});const t=document.querySelector(`[data-package-id="${e}"]`);t&&(t.classList.add("selected"),t.querySelector(".package-radio div").classList.remove("hidden")),document.getElementById("continueToPayment").disabled=!1};function P(e){const a=e.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),n=a&&a[0]||"",s=[];for(let o=0,i=n.length;o<i;o+=4)s.push(n.substring(o,o+4));return s.length?s.join(" "):e}document.getElementById("cardNumber").addEventListener("input",function(e){e.target.value=P(e.target.value)});document.getElementById("cardExpMonth").addEventListener("input",function(e){e.target.value=e.target.value.replace(/[^0-9]/g,"")});document.getElementById("cardExpYear").addEventListener("input",function(e){e.target.value=e.target.value.replace(/[^0-9]/g,"")});document.getElementById("cardCvv").addEventListener("input",function(e){e.target.value=e.target.value.replace(/[^0-9]/g,"")});async function $(){const e=document.getElementById("firstName").value.trim(),t=document.getElementById("lastName").value.trim(),a=document.getElementById("email").value.trim(),n=document.getElementById("phone").value.trim(),s=document.getElementById("dateOfBirth").value||null;try{const o=await fetch(`${g}/functions/v1/clubready-search-prospect`,{method:"POST",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({email:a,phone:n})}),i=await o.json();if(o.ok&&i.found&&i.prospect)return y=i.prospect.userId,f=i.prospect.userId.toString(),!0;const l=await fetch(`${g}/functions/v1/clubready-create-prospect`,{method:"POST",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({firstName:e,lastName:t,email:a,phone:n,dateOfBirth:s})}),c=await l.json();if(!l.ok)throw new Error(c.error||"Failed to create prospect");return y=c.prospect.id,f=c.prospect.clubreadyUserId.toString(),!0}catch(o){throw console.error("Error with prospect:",o),o}}async function L(){v();const e=document.getElementById("cardNumber").value.replace(/\s/g,""),t=document.getElementById("cardExpMonth").value,a=document.getElementById("cardExpYear").value,n=document.getElementById("cardCvv").value,s=document.getElementById("cardholderName").value.trim(),o=document.getElementById("billingZip").value.trim();if(!e||!t||!a||!n||!s||!o){r("Please fill in all payment fields");return}if(e.length<13||e.length>19){r("Please enter a valid card number");return}if(t.length!==2||parseInt(t)<1||parseInt(t)>12){r("Please enter a valid expiration month (01-12)");return}if(a.length!==4||parseInt(a)<new Date().getFullYear()){r("Please enter a valid expiration year");return}if(n.length<3||n.length>4){r("Please enter a valid CVV");return}const i=document.getElementById("submitPayment"),l=document.getElementById("submit-text"),c=document.getElementById("submit-spinner");i.disabled=!0,l.classList.add("hidden"),c.classList.remove("hidden");try{if(b){console.log("ðŸ§ª TEST MODE: Simulating payment without charging card");const w=d.find(E=>E.clubready_package_id===u);await new Promise(E=>setTimeout(E,2e3)),window.location.href=`thank-you-page.html?test=true&transactionId=TEST-${Date.now()}&packageName=${encodeURIComponent(w.name)}&amount=${w.price}`;return}(!y||!f)&&await $();const m=await fetch(`${g}/functions/v1/clubready-process-payment`,{method:"POST",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({prospectId:y,clubreadyUserId:f,packageId:u,cardNumber:e,cardExpMonth:t,cardExpYear:a,cardCvv:n,cardholderName:s,billingZip:o})}),p=await m.json();if(!m.ok)throw new Error(p.error||"Payment processing failed");window.location.href=`thank-you-page.html?transactionId=${p.transactionId}&packageName=${encodeURIComponent(p.packageName)}&amount=${p.amount}`}catch(m){console.error("Payment error:",m),r(m.message||"Payment processing failed. Please try again."),i.disabled=!1,l.classList.remove("hidden"),c.classList.add("hidden")}}window.goToStep1=k;window.goToStep2=x;window.goToStep3=S;window.processPayment=L;
