import"./modulepreload-polyfill-B5Qt9EMX.js";const u="https://agbmljovmexflolbgljn.supabase.co",p="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFnYm1sam92bWV4ZmxvbGJnbGpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3OTg3ODAsImV4cCI6MjA4MzM3NDc4MH0.dBQxzYtka4nD0eJQFH0Izj-jbQBX4kEoMS0vZrSOtRA";let l=null,m=null;function r(e){const s=document.getElementById("error-message"),a=document.getElementById("error-text");a.textContent=e,s.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{s.classList.add("hidden")},8e3)}function T(){document.getElementById("error-message").classList.add("hidden")}function D(e){const a=e.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),c=a&&a[0]||"",n=[];for(let t=0,o=c.length;t<o;t+=4)n.push(c.substring(t,t+4));return n.length?n.join(" "):e}const E=document.getElementById("cardNumber");E&&E.addEventListener("input",function(e){e.target.value=D(e.target.value)});const b=document.getElementById("cardExpMonth");b&&b.addEventListener("input",function(e){e.target.value=e.target.value.replace(/[^0-9]/g,"")});const B=document.getElementById("cardExpYear");B&&B.addEventListener("input",function(e){e.target.value=e.target.value.replace(/[^0-9]/g,"")});const P=document.getElementById("cardCvv");P&&P.addEventListener("input",function(e){e.target.value=e.target.value.replace(/[^0-9]/g,"")});async function S(){const e=document.getElementById("firstName").value.trim(),s=document.getElementById("lastName").value.trim(),a=document.getElementById("email").value.trim(),c=document.getElementById("phone").value.trim();try{const n=await fetch(`${u}/functions/v1/clubready-search-prospect`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({email:a,phone:c})}),t=await n.json();if(n.ok&&t.found&&t.prospect)return l=t.prospect.userId,m=t.prospect.userId.toString(),!0;const o=await fetch(`${u}/functions/v1/clubready-create-prospect`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({firstName:e,lastName:s,email:a,phone:c,dateOfBirth:null})}),i=await o.json();if(!o.ok)throw new Error(i.error||"Failed to create prospect");return l=i.prospect.id,m=i.prospect.clubreadyUserId.toString(),!0}catch(n){throw console.error("Error with prospect:",n),n}}const x=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.search.includes("test=true");if(x){const e=document.createElement("div");e.style.cssText="position: fixed; top: 0; left: 0; right: 0; background: #fbbf24; color: #000; text-align: center; padding: 12px; font-weight: 600; z-index: 9999; box-shadow: 0 2px 4px rgba(0,0,0,0.1);",e.innerHTML="ðŸ§ª TEST MODE - No real charges will be made to ClubReady",document.body.prepend(e),console.log("ðŸ§ª TEST MODE: Running in test mode - no real charges will be made")}async function O(){T();const e=document.getElementById("firstName").value.trim(),s=document.getElementById("lastName").value.trim(),a=document.getElementById("email").value.trim(),c=document.getElementById("phone").value.trim(),n=document.getElementById("cardNumber").value.replace(/\s/g,""),t=document.getElementById("cardExpMonth").value,o=document.getElementById("cardExpYear").value,i=document.getElementById("cardCvv").value,g=document.getElementById("cardholderName").value.trim(),h=document.getElementById("billingZip").value.trim(),N=document.getElementById("terms").checked;if(!e||!s||!a||!c){r("Please fill in all required contact information fields");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){r("Please enter a valid email address");return}if(!n||!t||!o||!i||!g||!h){r("Please fill in all payment fields");return}if(n.length<13||n.length>19){r("Please enter a valid card number");return}if(t.length!==2||parseInt(t)<1||parseInt(t)>12){r("Please enter a valid expiration month (01-12)");return}if(o.length!==4||parseInt(o)<new Date().getFullYear()){r("Please enter a valid expiration year");return}if(i.length<3||i.length>4){r("Please enter a valid CVV");return}if(!N){r("Please accept the Terms & Conditions and Liability Waiver");return}if(!window.selectedPackageData){r("Please select a package");return}const y=document.getElementById("submitPayment"),f=document.getElementById("submit-text"),I=document.getElementById("submit-arrow"),v=document.getElementById("submit-spinner");y.disabled=!0,f.textContent="Processing Your Payment...",I.classList.add("hidden"),v.classList.remove("hidden");try{if(x){console.log("ðŸ§ª TEST MODE: Simulating payment without charging card"),await new Promise(C=>setTimeout(C,1500)),window.location.href=`thank-you-page.html?packageName=${encodeURIComponent(window.selectedPackageData.name)}&amount=${window.selectedPackageData.price}`;return}(!l||!m)&&await S();const d={prospectId:l,clubreadyUserId:m,packageId:window.selectedPackageData.id,packageName:window.selectedPackageData.name,amount:window.selectedPackageData.price,cardNumber:n,cardExpMonth:t,cardExpYear:o,cardCvv:i,cardholderName:g,billingZip:h,firstName:e,lastName:s,email:a,phone:c},w=await fetch(`${u}/functions/v1/clubready-process-payment`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify(d)}),k=await w.json();if(!w.ok)throw new Error(k.error||"Payment failed");window.location.href=`thank-you-page.html?packageName=${encodeURIComponent(window.selectedPackageData.name)}&amount=${window.selectedPackageData.price}`}catch(d){console.error("Payment error:",d),r(d.message||"Payment processing failed. Please try again or call us at (281) 724-4422 for assistance."),y.disabled=!1,f.textContent="Complete Purchase - Claim Your Offer",I.classList.remove("hidden"),v.classList.add("hidden")}}window.processPayment=O;
