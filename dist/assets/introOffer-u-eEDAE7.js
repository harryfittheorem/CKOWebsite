import"./modulepreload-polyfill-B5Qt9EMX.js";const v="https://agbmljovmexflolbgljn.supabase.co",f="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFnYm1sam92bWV4ZmxvbGJnbGpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3OTg3ODAsImV4cCI6MjA4MzM3NDc4MH0.dBQxzYtka4nD0eJQFH0Izj-jbQBX4kEoMS0vZrSOtRA";let d=null,l=null;function r(e){const s=document.getElementById("error-message"),a=document.getElementById("error-text");a.textContent=e,s.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{s.classList.add("hidden")},8e3)}function N(){document.getElementById("error-message").classList.add("hidden")}function x(e){const a=e.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),c=a&&a[0]||"",n=[];for(let t=0,o=c.length;t<o;t+=4)n.push(c.substring(t,t+4));return n.length?n.join(" "):e}const E=document.getElementById("cardNumber");E&&E.addEventListener("input",function(e){e.target.value=x(e.target.value)});const b=document.getElementById("cardExpMonth");b&&b.addEventListener("input",function(e){e.target.value=e.target.value.replace(/[^0-9]/g,"")});const B=document.getElementById("cardExpYear");B&&B.addEventListener("input",function(e){e.target.value=e.target.value.replace(/[^0-9]/g,"")});const w=document.getElementById("cardCvv");w&&w.addEventListener("input",function(e){e.target.value=e.target.value.replace(/[^0-9]/g,"")});async function C(){const e=document.getElementById("firstName").value.trim(),s=document.getElementById("lastName").value.trim(),a=document.getElementById("email").value.trim(),c=document.getElementById("phone").value.trim();try{const n=await fetch(`${v}/functions/v1/clubready-search-prospect`,{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify({email:a,phone:c})}),t=await n.json();if(n.ok&&t.found&&t.prospect)return d=t.prospect.userId,l=t.prospect.userId.toString(),!0;const o=await fetch(`${v}/functions/v1/clubready-create-prospect`,{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify({firstName:e,lastName:s,email:a,phone:c,dateOfBirth:null})}),i=await o.json();if(!o.ok)throw new Error(i.error||"Failed to create prospect");return d=i.prospect.id,l=i.prospect.clubreadyUserId.toString(),!0}catch(n){throw console.error("Error with prospect:",n),n}}async function k(){N();const e=document.getElementById("firstName").value.trim(),s=document.getElementById("lastName").value.trim(),a=document.getElementById("email").value.trim(),c=document.getElementById("phone").value.trim(),n=document.getElementById("cardNumber").value.replace(/\s/g,""),t=document.getElementById("cardExpMonth").value,o=document.getElementById("cardExpYear").value,i=document.getElementById("cardCvv").value,u=document.getElementById("cardholderName").value.trim(),p=document.getElementById("billingZip").value.trim(),P=document.getElementById("terms").checked;if(!e||!s||!a||!c){r("Please fill in all required contact information fields");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){r("Please enter a valid email address");return}if(!n||!t||!o||!i||!u||!p){r("Please fill in all payment fields");return}if(n.length<13||n.length>19){r("Please enter a valid card number");return}if(t.length!==2||parseInt(t)<1||parseInt(t)>12){r("Please enter a valid expiration month (01-12)");return}if(o.length!==4||parseInt(o)<new Date().getFullYear()){r("Please enter a valid expiration year");return}if(i.length<3||i.length>4){r("Please enter a valid CVV");return}if(!P){r("Please accept the Terms & Conditions and Liability Waiver");return}if(!window.selectedPackageData){r("Please select a package");return}const g=document.getElementById("submitPayment"),h=document.getElementById("submit-text"),I=document.getElementById("submit-arrow"),y=document.getElementById("submit-spinner");g.disabled=!0,h.textContent="Processing Your Payment...",I.classList.add("hidden"),y.classList.remove("hidden");try{(!d||!l)&&await C();const m={prospectId:d,clubreadyUserId:l,packageId:window.selectedPackageData.id,packageName:window.selectedPackageData.name,amount:window.selectedPackageData.price,cardNumber:n,cardExpMonth:t,cardExpYear:o,cardCvv:i,cardholderName:u,billingZip:p,firstName:e,lastName:s,email:a,phone:c};window.location.href=`thank-you-page.html?packageName=${encodeURIComponent(window.selectedPackageData.name)}&amount=${window.selectedPackageData.price}`}catch(m){console.error("Payment error:",m),r(m.message||"Payment processing failed. Please try again or call us at (281) 724-4422 for assistance."),g.disabled=!1,h.textContent="Complete Purchase - Claim Your Offer",I.classList.remove("hidden"),y.classList.add("hidden")}}window.processPayment=k;
